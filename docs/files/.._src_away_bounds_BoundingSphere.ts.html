<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>../src/away/bounds/BoundingSphere.ts</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/away.base.Geometry.html">away.base.Geometry</a></li>
            
                <li><a href="../classes/away.base.Object3D.html">away.base.Object3D</a></li>
            
                <li><a href="../classes/away.base.SkinnedSubGeometry.html">away.base.SkinnedSubGeometry</a></li>
            
                <li><a href="../classes/away.base.SubGeometry.html">away.base.SubGeometry</a></li>
            
                <li><a href="../classes/away.base.SubGeometryBase.html">away.base.SubGeometryBase</a></li>
            
                <li><a href="../classes/away.events.AssetEvent.html">away.events.AssetEvent</a></li>
            
                <li><a href="../classes/away.events.CameraEvent.html">away.events.CameraEvent</a></li>
            
                <li><a href="../classes/away.events.Event.html">away.events.Event</a></li>
            
                <li><a href="../classes/away.events.EventDispatcher.html">away.events.EventDispatcher</a></li>
            
                <li><a href="../classes/away.events.GeometryEvent.html">away.events.GeometryEvent</a></li>
            
                <li><a href="../classes/away.events.HTTPStatusEvent.html">away.events.HTTPStatusEvent</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/away.base.html">away.base</a></li>
            
                <li><a href="../modules/away.events.html">away.events</a></li>
            
                <li><a href="../modules/away.geom.html">away.geom</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: ../src/away/bounds/BoundingSphere.ts</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * ...
 * @author Gary Paluk - http://www.plugin.io
 */

///&lt;reference path=&quot;../_definitions.ts&quot; /&gt;

module away.bounds
{
	export class BoundingSphere extends away.bounds.BoundingVolumeBase
	{
		
		private _radius:number = 0;
		private _centerX:number = 0;
		private _centerY:number = 0;
		private _centerZ:number = 0;
		
		constructor()
		{
			super();
		}
		
		public get radius():number
		{
			return this._radius;
		}
		
		public nullify()
		{
			super.nullify();
			this._centerX = this._centerY = this._centerZ = 0;
			this._radius = 0;
		}
		
		public isInFrustum( planes:away.math.Plane3D[], numPlanes:number ):boolean
		{
			for( var i:number = 0; i &lt; numPlanes; ++i )
			{
				var plane:away.math.Plane3D = planes[i];
				var flippedExtentX:number = plane.a &lt; 0? -this._radius : this._radius;
				var flippedExtentY:number = plane.b &lt; 0? -this._radius : this._radius;
				var flippedExtentZ:number = plane.c &lt; 0? -this._radius : this._radius;
				var projDist:number = plane.a*( this._centerX + flippedExtentX ) + plane.b*( this._centerY + flippedExtentY) + plane.c*( this._centerZ + flippedExtentZ ) - plane.d;
				if( projDist &lt; 0 )
				{
					return false;
				}
			}
			return true;
		}
		
		public fromSphere(center:away.geom.Vector3D, radius:number )
		{
			this._centerX = center.x;
			this._centerY = center.y;
			this._centerZ = center.z;
			this._radius = radius;
			this._pMax.x = this._centerX + radius;
			this._pMax.y = this._centerY + radius;
			this._pMax.z = this._centerZ + radius;
			this._pMin.x = this._centerX - radius;
			this._pMin.y = this._centerY - radius;
			this._pMin.z = this._centerZ - radius;
			this._pAabbPointsDirty = true;
			if( this._pBoundingRenderable )
			{
				this.pUpdateBoundingRenderable();
			}
		}
		
		public fromExtremes( minX:number, minY:number, minZ:number, maxX:number, maxY:number, maxZ:number )
		{
			this._centerX = (maxX + minX)*.5;
			this._centerY = (maxY + minY)*.5;
			this._centerZ = (maxZ + minZ)*.5;
			
			var d:number = maxX - minX;
			var y:number = maxY - minY;
			var z:number = maxZ - minZ;
			if( y &gt; d )
			{
				d = y;
			}
			if (z &gt; d)
			{
				d = z;
			}
			this._radius = d*Math.sqrt(.5);
			super.fromExtremes( minX, minY, minZ, maxX, maxY, maxZ );
		}
		
		public clone():away.bounds.BoundingVolumeBase
		{
			var clone:BoundingSphere = new BoundingSphere();
			clone.fromSphere( new away.geom.Vector3D( this._centerX, this._centerY, this._centerZ), this._radius );
			return clone;
		}
		
		public rayIntersection( position:away.geom.Vector3D, direction:away.geom.Vector3D, targetNormal:away.geom.Vector3D):number
		{
			if ( this.containsPoint(position) )
			{
				return 0;
			}
			
			var px:number = position.x - this._centerX, py:number = position.y - this._centerY, pz:number = position.z - this._centerZ;
			var vx:number = direction.x, vy:number = direction.y, vz:number = direction.z;
			var rayEntryDistance:number;
			
			var a:number = vx*vx + vy*vy + vz*vz;
			var b:number = 2*( px*vx + py*vy + pz*vz );
			var c:number = px*px + py*py + pz*pz - this._radius * this._radius;
			var det:number = b*b - 4*a*c;
			
			if (det &gt;= 0)
			{ // ray goes through sphere
				var sqrtDet:number = Math.sqrt(det);
				rayEntryDistance = ( -b - sqrtDet )/( 2*a );
				if( rayEntryDistance &gt;= 0 )
				{
					targetNormal.x = px + rayEntryDistance*vx;
					targetNormal.y = py + rayEntryDistance*vy;
					targetNormal.z = pz + rayEntryDistance*vz;
					targetNormal.normalize();
					
					return rayEntryDistance;
				}
			}
			// ray misses sphere
			return -1;
		}
		
		public containsPoint( position:away.geom.Vector3D ):boolean
		{
			var px:number = position.x - this._centerX;
			var py:number = position.y - this._centerY;
			var pz:number = position.z - this._centerZ;
			var distance:number = Math.sqrt( px*px + py*py + pz*pz );
			return distance &lt;= this._radius;
		}
		
		public pUpdateBoundingRenderable()
		{
			var sc:number = this._radius;
			if (sc == 0)
			{
				sc = 0.001;
			}
			this._pBoundingRenderable.scaleX = sc;
			this._pBoundingRenderable.scaleY = sc;
			this._pBoundingRenderable.scaleZ = sc;
			this._pBoundingRenderable.x = this._centerX;
			this._pBoundingRenderable.y = this._centerY;
			this._pBoundingRenderable.z = this._centerZ;
		}
		
		// TODO pCreateBoundingRenderable():WireframePrimitiveBase

		public pCreateBoundingRenderable():away.primitives.WireframePrimitiveBase
		{
			return new away.primitives.WireframeSphere(1, 16, 12, 0xffffff, 0.5);
		}

		
		//@override
		public classifyToPlane( plane:away.math.Plane3D ):number
		{
			var a:number = plane.a;
			var b:number = plane.b;
			var c:number = plane.c;
			var dd:number = a*this._centerX + b*this._centerY + c*this._centerZ - plane.d;
			if( a &lt; 0 )
			{
				a = -a;
			}
			if( b &lt; 0 )
			{
				b = -b;
			}
			if( c &lt; 0 )
			{
				c = -c;
			}
			var rr:Number = (a + b + c)*this._radius;
			
			return dd &gt; rr? away.math.PlaneClassification.FRONT :
				dd &lt; -rr? away.math.PlaneClassification.BACK :
				away.math.PlaneClassification.INTERSECT;
		}
		
		public transformFrom( bounds:away.bounds.BoundingVolumeBase, matrix:away.geom.Matrix3D)
		{
			var sphere:away.bounds.BoundingSphere = &lt;away.bounds.BoundingSphere&gt; bounds;
			var cx:number = sphere._centerX;
			var cy:number = sphere._centerY;
			var cz:number = sphere._centerZ;
			var raw:number[] = [];
            matrix.copyRawDataTo( raw );
			var m11:number = raw[0], m12:number = raw[4], m13:number = raw[8], m14:number = raw[12];
			var m21:number = raw[1], m22:number = raw[5], m23:number = raw[9], m24:number = raw[13];
			var m31:number = raw[2], m32:number = raw[6], m33:number = raw[10], m34:number = raw[14];
			
			this._centerX = cx*m11 + cy*m12 + cz*m13 + m14;
			this._centerY = cx*m21 + cy*m22 + cz*m23 + m24;
			this._centerZ = cx*m31 + cy*m32 + cz*m33 + m34;
			
			if (m11 &lt; 0)
				m11 = -m11;
			if (m12 &lt; 0)
				m12 = -m12;
			if (m13 &lt; 0)
				m13 = -m13;
			if (m21 &lt; 0)
				m21 = -m21;
			if (m22 &lt; 0)
				m22 = -m22;
			if (m23 &lt; 0)
				m23 = -m23;
			if (m31 &lt; 0)
				m31 = -m31;
			if (m32 &lt; 0)
				m32 = -m32;
			if (m33 &lt; 0)
				m33 = -m33;
			var r:number = sphere._radius;
			var rx:number = m11 + m12 + m13;
			var ry:number = m21 + m22 + m23;
			var rz:number = m31 + m32 + m33;
			this._radius = r*Math.sqrt(rx*rx + ry*ry + rz*rz);
			
			this._pMin.x = this._centerX - this._radius;
			this._pMin.y = this._centerY - this._radius;
			this._pMin.z = this._centerZ - this._radius;
			
			this._pMax.x = this._centerX + this._radius;
			this._pMax.y = this._centerY + this._radius;
			this._pMax.z = this._centerZ + this._radius;
		}
	}
}
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
