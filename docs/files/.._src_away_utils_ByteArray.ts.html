<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>../src/away/utils/ByteArray.ts</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/away.base.Geometry.html">away.base.Geometry</a></li>
            
                <li><a href="../classes/away.base.Object3D.html">away.base.Object3D</a></li>
            
                <li><a href="../classes/away.base.SkinnedSubGeometry.html">away.base.SkinnedSubGeometry</a></li>
            
                <li><a href="../classes/away.base.SubGeometry.html">away.base.SubGeometry</a></li>
            
                <li><a href="../classes/away.base.SubGeometryBase.html">away.base.SubGeometryBase</a></li>
            
                <li><a href="../classes/away.events.AssetEvent.html">away.events.AssetEvent</a></li>
            
                <li><a href="../classes/away.events.CameraEvent.html">away.events.CameraEvent</a></li>
            
                <li><a href="../classes/away.events.Event.html">away.events.Event</a></li>
            
                <li><a href="../classes/away.events.EventDispatcher.html">away.events.EventDispatcher</a></li>
            
                <li><a href="../classes/away.events.GeometryEvent.html">away.events.GeometryEvent</a></li>
            
                <li><a href="../classes/away.events.HTTPStatusEvent.html">away.events.HTTPStatusEvent</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/away.base.html">away.base</a></li>
            
                <li><a href="../modules/away.events.html">away.events</a></li>
            
                <li><a href="../modules/away.geom.html">away.geom</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: ../src/away/utils/ByteArray.ts</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * ...
 * @author Gary Paluk - http://www.plugin.io
 */

///&lt;reference path=&quot;../_definitions.ts&quot;/&gt;

module away.utils
{
	export class ByteArray extends ByteArrayBase
	{
		
		public maxlength:number = 0;
		public arraybytes; //ArrayBuffer  
		public unalignedarraybytestemp; //ArrayBuffer
		
		constructor()
		{
			super();
			this._mode = &quot;Typed array&quot;;
			this.maxlength = 4;
			this.arraybytes = new ArrayBuffer( this.maxlength );
			this.unalignedarraybytestemp = new ArrayBuffer( 16 );
		}
		
		public ensureWriteableSpace( n:number )
		{
			this.ensureSpace( n + this.position );
		}

        public setArrayBuffer( aBuffer : ArrayBuffer ) : void
        {

            this.ensureSpace( aBuffer.byteLength );

            this.length                     = aBuffer.byteLength;

            var inInt8AView     : Int8Array = new Int8Array( aBuffer );
            var localInt8View   : Int8Array = new Int8Array( this.arraybytes, 0, this.length );

                localInt8View.set( inInt8AView );

            this.position = 0;

        }

        public getBytesAvailable() : number
        {
            return ( this.length ) - ( this.position ) ;
        }

		public ensureSpace( n:number )
		{
			if ( n &gt; this.maxlength )
			{
				var newmaxlength:number = (n+255)&amp;(~255); 
				var newarraybuffer = new ArrayBuffer(newmaxlength);                              
				var view = new Uint8Array( this.arraybytes, 0, this.length ); 
				var newview = new Uint8Array( newarraybuffer, 0, this.length ); 
				newview.set( view );      // memcpy                        
				this.arraybytes = newarraybuffer;
				this.maxlength = newmaxlength;                         
			}
		}
		
		public writeByte( b:number )
		{                    
			this.ensureWriteableSpace( 1 );         
			var view = new Int8Array( this.arraybytes ); 
			view[ this.position++ ] = (~~b); // ~~ is cast to int in js...
			if ( this.position &gt; this.length )
			{
				this.length = this.position;
			}
		}
		
		public readByte()
		{
			if ( this.position &gt;= this.length )
			{
				throw &quot;ByteArray out of bounds read. Positon=&quot;+this.position+&quot;, Length=&quot;+this.length; 
			}
			var view = new Int8Array(this.arraybytes);

			return view[ this.position++ ];
		}

        public readBytes( bytes : ByteArray , offset : number = 0 , length : number = 0 )
        {

            if (length == null)
            {
                length = bytes.length;
            }

            bytes.ensureWriteableSpace(offset + length);

            var byteView        : Int8Array = new Int8Array( bytes.arraybytes );
            var localByteView   : Int8Array = new Int8Array( this.arraybytes );

            byteView.set( localByteView.subarray( this.position , this.position + length), offset);

            this.position += length;

            if ( length + offset &gt; bytes.length)
            {
                bytes.length += ( length + offset ) - bytes.length;
            }

        }

		public writeUnsignedByte( b:number )
		{                    
			this.ensureWriteableSpace( 1 );         
			var view = new Uint8Array( this.arraybytes ); 
			view[this.position++] = (~~b) &amp; 0xff; // ~~ is cast to int in js...
			if ( this.position &gt; this.length )
			{
				this.length = this.position;
			}
		}

		public readUnsignedByte()
		{     
			if ( this.position &gt;= this.length )
			{
				throw &quot;ByteArray out of bounds read. Positon=&quot;+this.position+&quot;, Length=&quot;+this.length; 
			}
			var view = new Uint8Array(this.arraybytes); 
			return view[this.position++];                
		}
		
		public writeUnsignedShort( b:number )
		{       
			this.ensureWriteableSpace ( 2 );         
			if ( ( this.position &amp; 1 ) == 0 )
			{
				var view = new Uint16Array( this.arraybytes );
				view[ this.position &gt;&gt; 1 ] = (~~b) &amp; 0xffff; // ~~ is cast to int in js...
			} 
			else
			{
				var view = new Uint16Array(this.unalignedarraybytestemp, 0, 1 );
				view[0] = (~~b) &amp; 0xffff;
				var view2 = new Uint8Array( this.arraybytes, this.position, 2 );                         
				var view3 = new Uint8Array( this.unalignedarraybytestemp, 0, 2 ); 
				view2.set(view3);               
			}
			this.position += 2;
			if ( this.position &gt; this.length )
			{
				this.length = this.position;
			}
		}

        public readUTFBytes(len:number):string {

            var value   : string    = &quot;&quot;;
            var max     : number    = this.position + len;
            var data    : DataView  = new DataView( this.arraybytes );

            // utf8-encode
            while (this.position &lt; max) {

                var c : number = data.getUint8(this.position++);

                if (c &lt; 0x80) {

                    if (c == 0) break;
                    value += String.fromCharCode(c);

                } else if (c &lt; 0xE0) {

                    value += String.fromCharCode(((c &amp; 0x3F) &lt;&lt; 6) |(data.getUint8(this.position++) &amp; 0x7F));

                } else if (c &lt; 0xF0) {

                    var c2 = data.getUint8(this.position++);
                    value += String.fromCharCode(((c &amp; 0x1F) &lt;&lt; 12) |((c2 &amp; 0x7F) &lt;&lt; 6) |(data.getUint8(this.position++) &amp; 0x7F));

                } else {

                    var c2 = data.getUint8(this.position++);
                    var c3 = data.getUint8(this.position++);

                    value += String.fromCharCode(((c &amp; 0x0F) &lt;&lt; 18) |((c2 &amp; 0x7F) &lt;&lt; 12) |((c3 &lt;&lt; 6) &amp; 0x7F) |(data.getUint8(this.position++) &amp; 0x7F));

                }

            }

            return value;

        }

        public readInt():number
        {

            var data    : DataView      = new DataView( this.arraybytes );
            var int     : number        = data.getInt32( this.position );

            this.position += 4;

            return int;

        }

        public readShort():number
        {

            var data    : DataView      = new DataView( this.arraybytes );
            var short   : number        = data.getInt16(this.position );

            this.position += 2;
            return short;

        }

        public readDouble():number
        {
            var data    : DataView      = new DataView( this.arraybytes );
            var double  : number        = data.getFloat64( this.position );

            this.position += 8;
            return double;

        }

		public readUnsignedShort()
		{     
			if ( this.position &gt; this.length + 2 )
			{
				throw &quot;ByteArray out of bounds read. Position=&quot; + this.position + &quot;, Length=&quot; + this.length;
			}
			if ( ( this.position &amp; 1 )==0 )
			{
				var view = new Uint16Array( this.arraybytes );
				var pa:number = this.position &gt;&gt; 1;
				this.position += 2;
				return view[ pa ];
			}
			else
			{
				var view = new Uint16Array( this.unalignedarraybytestemp, 0, 1 );
				var view2 = new Uint8Array( this.arraybytes,this.position, 2 );
				var view3 = new Uint8Array( this.unalignedarraybytestemp, 0, 2 );
				view3.set( view2 );
				this.position += 2;
				return view[0];
			}
		}
		
		public writeUnsignedInt( b:number )
		{                    
			this.ensureWriteableSpace( 4 );         
			if ( ( this.position &amp; 3 ) == 0 )
			{
				var view = new Uint32Array( this.arraybytes );
				view[ this.position &gt;&gt; 2 ] = (~~b) &amp; 0xffffffff; // ~~ is cast to int in js...            
			}
			else
			{
				var view = new Uint32Array( this.unalignedarraybytestemp, 0, 1 );
				view[0] = (~~b) &amp; 0xffffffff; 
				var view2 = new Uint8Array( this.arraybytes, this.position, 4 );                         
				var view3 = new Uint8Array( this.unalignedarraybytestemp, 0, 4 ); 
				view2.set( view3 );                 
			}        
			this.position+=4; 
			if ( this.position &gt; this.length )
			{
				this.length = this.position;
			}
		}

		public readUnsignedInt()
		{

			if ( this.position &gt; this.length + 4 )
			{
				throw &quot;ByteArray out of bounds read. Position=&quot; + this.position + &quot;, Length=&quot; + this.length;
			}
			if ( ( this.position &amp; 3 ) == 0 )
			{
				var view = new Uint32Array( this.arraybytes );
				var pa:number = this.position &gt;&gt; 2;
				this.position += 4;
				return view[ pa ];
			}
			else
			{
				var view = new Uint32Array( this.unalignedarraybytestemp, 0, 1 );
				var view2 = new Uint8Array( this.arraybytes,this.position, 4 );
				var view3 = new Uint8Array( this.unalignedarraybytestemp, 0, 4 );
				view3.set( view2 );
				this.position += 4;
				return view[0];
			}
		}
		
		public writeFloat( b:number )
		{                    
			this.ensureWriteableSpace( 4 );         
			if ( ( this.position &amp; 3 ) == 0 ) {
				var view = new Float32Array( this.arraybytes );
				view[ this.position &gt;&gt; 2 ] = b; 
			}
			else
			{
				var view = new Float32Array( this.unalignedarraybytestemp, 0, 1 );
				view[0] = b;
				var view2 = new Uint8Array( this.arraybytes,this.position, 4 );
				var view3 = new Uint8Array( this.unalignedarraybytestemp, 0, 4 );
				view2.set(view3);
			}
			this.position += 4; 
			if ( this.position &gt; this.length )
			{
				this.length = this.position;
			}
		}
		
		public readFloat()
		{     
			if ( this.position &gt; this.length + 4 )
			{
				throw &quot;ByteArray out of bounds read. Positon=&quot;+this.position+&quot;, Length=&quot;+this.length;         
			}
			if ( (this.position&amp;3) == 0 )
			{
				var view = new Float32Array(this.arraybytes);
				var pa = this.position &gt;&gt; 2;
				this.position += 4;
				return view[pa];
			}
			else
			{
				var view = new Float32Array( this.unalignedarraybytestemp, 0, 1 );
				var view2 = new Uint8Array( this.arraybytes, this.position, 4 );
				var view3 = new Uint8Array( this.unalignedarraybytestemp, 0, 4 );
				view3.set( view2 );
				this.position += 4;
				return view[ 0 ];
			}
		}
	}
}
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
